<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">
<dom-module id="album-list">
	<style type="text/css">
		:host
		{
			width: 700px;
			display: block;
			padding-bottom: 40px;
		}
		.albumCard
		{
			margin: 16px;
			border-radius: 2px;
			display: block;
			width: auto;
			padding-bottom: 16px;
			background-color:var(--paper-grey-50);
		}
		.albumRow
		{
			display: flex;
			width: auto;
			position:relative;
		}
		.albumRow:hover
		{
			background-color: var(--paper-grey-100);
		}
		.albumRow:hover .playIcon
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
		.albumRow:hover span
		{
			display: none;
		}
		.playIcon
		{
			display: none;
			width: 24px;
			height: 24px;
			top: 2px;
			left: 8px;
			position: absolute;
			z-index: 3;
		}
		.albumHeader
		{
			display: inline-flex;
			display: -webkit-inline-flex;
		}
		.albumCover
		{
			background-color: gray;
			width: 200px;
			height: 200px;
		}
		.albumTitle
		{
			margin: 16px;
		}
	</style>
	<template>
		<iron-ajax id="ajax" auto url="../metadata.json" handle-as="json" last-response="{{data}}"></iron-ajax>
		<template is="dom-repeat" items="{{data}}" as="album"  id="albumList">
			<paper-material class="albumCard" elevation="1">
				<div class="albumHeader">
					<div class="albumCover"></div>
					<div class="albumTitle">
						<h1>{{album.album}}</h1>
						<h3>{{album.artist}}</h3>
					</div>
				</div>
				<template is="dom-repeat" items="{{album.tracks}}" as="track">
					<paper-item class="albumRow">
						<div class="album-column" style="width:40px;text-align:right">
						<span style="margin-right:25px">{{track.track}}</span>
						<paper-icon-button class="playIcon" on-click="trackFromAlbumPlayClicked" icon="av:play-arrow"></paper-icon-button>
						</div>
						<div class="album-column" style="flex:1;-webkit-flex:1;">{{track.name}}</div>
						<div class="album-column" style="width:50px;">{{track.length}}</div>
					</paper-item>
				</template>
			</paper-material>
		</template>
	</template>
	<script type="text/javascript">

	Polymer({
		is:"album-list",
		properties:{
			toPlayTracks:{
				type:Object,
				notify:true
			}
		},
		trackFromAlbumPlayClicked: function(e)
		{
			if(!(typeof e.model.track.file === 'undefined'))
			{
				
				var albumList = this.$$("#albumList");
				var toPlayTracksObject = {
					tracks:null,
					startIndex:0
				};
				var newArray = [];
				var albumModel = albumList.modelForElement(e.target).album;

				for (var i = 0; i < albumList.modelForElement(e.target).album.tracks.length; i++) 
				{
					var newTrackObject = albumList.modelForElement(e.target).album.tracks[i];
					if(newTrackObject == e.model.track)
					{
						toPlayTracksObject.startIndex = i
					}

					newTrackObject.album = albumModel.album;
					newTrackObject.artist = albumModel.artist;

					newArray.push(newTrackObject);
				};

				toPlayTracksObject.tracks = newArray;

				this.toPlayTracks = toPlayTracksObject;
			}
		},
	});	
	</script>
</dom-module>