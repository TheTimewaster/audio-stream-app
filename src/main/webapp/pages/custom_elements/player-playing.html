<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="player-playing-small.html">
<link rel="import" href="player-playing-tiny.html">
<dom-module id="player-playing">
	<style>
		:host {
			display: flex;
			width:100%;
			min-height:60px;
			height:10%;
		}
		@media(max-height:480px)
		{
			:host
			{
				height:15%;
			}
		}
		#playerModeSelector
		{
			width:100%;
			height:100%;
		}
	</style>
	<template>
		<neon-animated-pages id="playerModeSelector" selected="0">
			<player-playing-small playback-progress="{{playBackProgress}}" currently-playing="[[currentlyPlaying]]"></player-playing-small>
			<player-playing-tiny on-change-to-small="changePlayerMode(small)"></player-playing-tiny>
		</neon-animated-pages>
		<audio id="audioElement">
			<source id="sourceElement" src="" type="audio/mpeg" codecs="mp3"/>
		</audio>
	</template>
	<script>
		var audioElement;

		Polymer({
			is: 'player-playing',
			properties:
			{
				currentlyPlaying:
				{
					type:Object
				},
				playBackProgress:
				{
					value:0
				}
			},
			ready:function()
			{
				audioElement = this.$$('#audioElement');

				audioElement.ontimeupdate = this.playBackRunning;

				//track ended event
				audioElement.onpause = this.playBackEnded;
			},
			concatStreamingURL:function(objectID)
			{
				if (objectID != null) {
					return "/api/stream/" + objectID;
				};
			},
			changePlayerMode:function(mode)
			{
				if(mode == "small")
				{
					this.$.playerModeSelector.selected = 0;
				}
				else
				{
					this.$.playerModeSelector.selected = 1;
				}
			},
			playBackRunning:function()
			{
				if(Math.round(300 * audioElement.currentTime/audioElement.duration) > playBackProgress)
					{
						this.playBackProgress = 300 * audioElement.currentTime/audioElement.duration;
					}
			},
			playBackEnded:function()
			{
				if(audioElement.currentTime == audioElement.duration)
		   		{
		   			//playback ended
		   		}
			}
		});
	</script>
</dom-module>