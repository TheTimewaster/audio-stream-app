<!DOCTYPE html>
<html>
	<head>
		<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
		<link rel="import" href="bower_components/polymer/polymer.html">
		<link rel="import" href="bower_components/paper-styles/paper-styles.html">
		<link rel="import" href="bower_components/paper-button/paper-button.html">
		<style type="text/css">
		body,html
		{
			    height: 100%;
			    margin: 0;
			    background-color: #E5E5E5;
			    font-family: 'Roboto Light', sans-serif;
		}
		h2
		{
			font-size: 30px;
		}
		</style>
	</head>
	<body>
		<template is="dom-bind" id="app">
				<h2>Hello World!</h2>
				<paper-button on-click="clickToPlayHandler">
				play now!
				</paper-button>
			</template>
		<script type="text/javascript">
			window.AudioContext = window.AudioContext||window.webkitAudioContext;
			context = new AudioContext();

			var app = document.querySelector('#app');

			app.clickToPlayHandler = function()
			{
				streamSong();
			}

			function streamSong()
			{
				var request = new XMLHttpRequest();
				request.open("GET","/stream_now", true);
				request.responseType = "arraybuffer"; 

				request.onload = function()
				{
					var Data = request.response;
					processData(Data);
				};

				request.send();
			}

			function processData(Data)
			{
				source = context.createBufferSource();
				context.decodeAudioData(Data, function(buffer)
				{
					console.log("asdf");
					source.buffer = buffer;
					source.connect(context.destination);
					source.start(0);
				});
			}
		</script>
	</body>
</html>
